<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>rollup插件 | sunnyxujian&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/img/favicon1.ico">
    <meta name="description" content="web前端技术博客,专注web前端学习与总结。JavaScript,js,ES6,TypeScript,vue,react,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#4fc08d">
    <link rel="preload" href="/assets/css/0.styles.280b48f2.css" as="style"><link rel="preload" href="/assets/js/app.d76a6140.js" as="script"><link rel="preload" href="/assets/js/3.724bf448.js" as="script"><link rel="preload" href="/assets/js/5.f79ce4cb.js" as="script"><link rel="preload" href="/assets/js/84.17e1691d.js" as="script"><link rel="prefetch" href="/assets/js/10.33e63f5b.js"><link rel="prefetch" href="/assets/js/100.88170c76.js"><link rel="prefetch" href="/assets/js/101.8d54c91e.js"><link rel="prefetch" href="/assets/js/102.7dff272c.js"><link rel="prefetch" href="/assets/js/103.b5f8461b.js"><link rel="prefetch" href="/assets/js/104.a6516759.js"><link rel="prefetch" href="/assets/js/105.ad5b08fd.js"><link rel="prefetch" href="/assets/js/106.157581cd.js"><link rel="prefetch" href="/assets/js/107.68e05ec4.js"><link rel="prefetch" href="/assets/js/108.76688ddd.js"><link rel="prefetch" href="/assets/js/109.73504a9d.js"><link rel="prefetch" href="/assets/js/11.0de4544b.js"><link rel="prefetch" href="/assets/js/110.289cecf3.js"><link rel="prefetch" href="/assets/js/111.2229d3c3.js"><link rel="prefetch" href="/assets/js/112.b63d71e6.js"><link rel="prefetch" href="/assets/js/113.1b781191.js"><link rel="prefetch" href="/assets/js/114.8d59c3f9.js"><link rel="prefetch" href="/assets/js/115.8e3070e3.js"><link rel="prefetch" href="/assets/js/116.e94d9ee8.js"><link rel="prefetch" href="/assets/js/117.e1ebdb1a.js"><link rel="prefetch" href="/assets/js/118.92597187.js"><link rel="prefetch" href="/assets/js/119.02881f9b.js"><link rel="prefetch" href="/assets/js/12.056774d7.js"><link rel="prefetch" href="/assets/js/120.f7f95b51.js"><link rel="prefetch" href="/assets/js/121.d87b90ad.js"><link rel="prefetch" href="/assets/js/122.8e81d12f.js"><link rel="prefetch" href="/assets/js/123.d1c5d272.js"><link rel="prefetch" href="/assets/js/124.071d3876.js"><link rel="prefetch" href="/assets/js/125.8da325b6.js"><link rel="prefetch" href="/assets/js/126.f3fac94a.js"><link rel="prefetch" href="/assets/js/127.705b0231.js"><link rel="prefetch" href="/assets/js/128.2d0cce43.js"><link rel="prefetch" href="/assets/js/129.136c9093.js"><link rel="prefetch" href="/assets/js/13.c41460b7.js"><link rel="prefetch" href="/assets/js/130.e273b0cd.js"><link rel="prefetch" href="/assets/js/131.1cdc1f03.js"><link rel="prefetch" href="/assets/js/132.e825fb82.js"><link rel="prefetch" href="/assets/js/133.0d293ef7.js"><link rel="prefetch" href="/assets/js/134.a0d635b9.js"><link rel="prefetch" href="/assets/js/135.1af5e654.js"><link rel="prefetch" href="/assets/js/136.bd4c2e25.js"><link rel="prefetch" href="/assets/js/137.e7d9d057.js"><link rel="prefetch" href="/assets/js/138.b2c4087c.js"><link rel="prefetch" href="/assets/js/139.9d81cea3.js"><link rel="prefetch" href="/assets/js/14.6f0de051.js"><link rel="prefetch" href="/assets/js/140.462f2f68.js"><link rel="prefetch" href="/assets/js/141.bfd924b2.js"><link rel="prefetch" href="/assets/js/142.f02c9f6c.js"><link rel="prefetch" href="/assets/js/143.3f153586.js"><link rel="prefetch" href="/assets/js/144.bba01f15.js"><link rel="prefetch" href="/assets/js/145.e6a25735.js"><link rel="prefetch" href="/assets/js/146.cd93e9ca.js"><link rel="prefetch" href="/assets/js/147.63f46f4b.js"><link rel="prefetch" href="/assets/js/148.138380f5.js"><link rel="prefetch" href="/assets/js/149.3980b184.js"><link rel="prefetch" href="/assets/js/15.60153c2f.js"><link rel="prefetch" href="/assets/js/150.7e8cb34a.js"><link rel="prefetch" href="/assets/js/151.559be224.js"><link rel="prefetch" href="/assets/js/152.a51c57fb.js"><link rel="prefetch" href="/assets/js/153.887a69dd.js"><link rel="prefetch" href="/assets/js/154.76aed2e7.js"><link rel="prefetch" href="/assets/js/155.5843b58d.js"><link rel="prefetch" href="/assets/js/156.9b68b27b.js"><link rel="prefetch" href="/assets/js/157.c79c5fef.js"><link rel="prefetch" href="/assets/js/158.3e7d2e05.js"><link rel="prefetch" href="/assets/js/159.ed6b9d8b.js"><link rel="prefetch" href="/assets/js/16.82dd19ed.js"><link rel="prefetch" href="/assets/js/160.37259815.js"><link rel="prefetch" href="/assets/js/161.7a48a04c.js"><link rel="prefetch" href="/assets/js/162.ffd40c22.js"><link rel="prefetch" href="/assets/js/163.eaf5d0ee.js"><link rel="prefetch" href="/assets/js/164.e5353a66.js"><link rel="prefetch" href="/assets/js/165.fe4a33a5.js"><link rel="prefetch" href="/assets/js/166.eb2a137a.js"><link rel="prefetch" href="/assets/js/167.d209e1d2.js"><link rel="prefetch" href="/assets/js/168.e1d97e56.js"><link rel="prefetch" href="/assets/js/169.c96bc779.js"><link rel="prefetch" href="/assets/js/17.c33de90a.js"><link rel="prefetch" href="/assets/js/170.53428bf5.js"><link rel="prefetch" href="/assets/js/171.685b798b.js"><link rel="prefetch" href="/assets/js/172.8127d652.js"><link rel="prefetch" href="/assets/js/173.f63942d1.js"><link rel="prefetch" href="/assets/js/174.7aaff485.js"><link rel="prefetch" href="/assets/js/175.411e5ac1.js"><link rel="prefetch" href="/assets/js/176.e65c95bb.js"><link rel="prefetch" href="/assets/js/177.90e620f4.js"><link rel="prefetch" href="/assets/js/178.d4ea1cdd.js"><link rel="prefetch" href="/assets/js/179.01df97a3.js"><link rel="prefetch" href="/assets/js/18.456e4218.js"><link rel="prefetch" href="/assets/js/180.0f5cda26.js"><link rel="prefetch" href="/assets/js/181.d3f6c371.js"><link rel="prefetch" href="/assets/js/182.18df4323.js"><link rel="prefetch" href="/assets/js/183.ce19b32c.js"><link rel="prefetch" href="/assets/js/184.780c19d0.js"><link rel="prefetch" href="/assets/js/185.8571a197.js"><link rel="prefetch" href="/assets/js/186.716b43aa.js"><link rel="prefetch" href="/assets/js/187.6acda53b.js"><link rel="prefetch" href="/assets/js/188.9460ea0f.js"><link rel="prefetch" href="/assets/js/189.f69905c1.js"><link rel="prefetch" href="/assets/js/19.1223b684.js"><link rel="prefetch" href="/assets/js/190.d0fb2193.js"><link rel="prefetch" href="/assets/js/191.dd8d7bea.js"><link rel="prefetch" href="/assets/js/192.e7ab2686.js"><link rel="prefetch" href="/assets/js/193.e1aef55c.js"><link rel="prefetch" href="/assets/js/194.790d107b.js"><link rel="prefetch" href="/assets/js/195.ce213cdb.js"><link rel="prefetch" href="/assets/js/196.d8e7ce65.js"><link rel="prefetch" href="/assets/js/197.6ca159ed.js"><link rel="prefetch" href="/assets/js/198.1f9103bf.js"><link rel="prefetch" href="/assets/js/199.647fab7d.js"><link rel="prefetch" href="/assets/js/2.900ae423.js"><link rel="prefetch" href="/assets/js/20.bc706733.js"><link rel="prefetch" href="/assets/js/200.5c297a04.js"><link rel="prefetch" href="/assets/js/201.b860990a.js"><link rel="prefetch" href="/assets/js/202.a2dee90c.js"><link rel="prefetch" href="/assets/js/203.6df560c4.js"><link rel="prefetch" href="/assets/js/204.ba95b5a5.js"><link rel="prefetch" href="/assets/js/205.8878cde9.js"><link rel="prefetch" href="/assets/js/206.cf365d5c.js"><link rel="prefetch" href="/assets/js/207.1265f6f6.js"><link rel="prefetch" href="/assets/js/208.d3292fda.js"><link rel="prefetch" href="/assets/js/209.31ad945b.js"><link rel="prefetch" href="/assets/js/21.d5b15a9e.js"><link rel="prefetch" href="/assets/js/210.d4095a65.js"><link rel="prefetch" href="/assets/js/211.da7e7f0b.js"><link rel="prefetch" href="/assets/js/212.86ffee1c.js"><link rel="prefetch" href="/assets/js/213.fc14f988.js"><link rel="prefetch" href="/assets/js/214.276b3100.js"><link rel="prefetch" href="/assets/js/215.977e7988.js"><link rel="prefetch" href="/assets/js/216.245b5975.js"><link rel="prefetch" href="/assets/js/217.e36d5149.js"><link rel="prefetch" href="/assets/js/218.f7b84d56.js"><link rel="prefetch" href="/assets/js/219.b17c2d18.js"><link rel="prefetch" href="/assets/js/22.305d3e0e.js"><link rel="prefetch" href="/assets/js/220.89978bee.js"><link rel="prefetch" href="/assets/js/221.94e9bc2b.js"><link rel="prefetch" href="/assets/js/222.d509002e.js"><link rel="prefetch" href="/assets/js/223.7d5329ab.js"><link rel="prefetch" href="/assets/js/224.d1efb469.js"><link rel="prefetch" href="/assets/js/225.068d1edc.js"><link rel="prefetch" href="/assets/js/226.203df552.js"><link rel="prefetch" href="/assets/js/227.ee66205e.js"><link rel="prefetch" href="/assets/js/228.611dcfa5.js"><link rel="prefetch" href="/assets/js/229.4570cebd.js"><link rel="prefetch" href="/assets/js/23.93f0d1ba.js"><link rel="prefetch" href="/assets/js/230.479fc52e.js"><link rel="prefetch" href="/assets/js/231.ac2939f8.js"><link rel="prefetch" href="/assets/js/232.1b593957.js"><link rel="prefetch" href="/assets/js/233.ed19c07d.js"><link rel="prefetch" href="/assets/js/234.1b8860c5.js"><link rel="prefetch" href="/assets/js/235.099f8d57.js"><link rel="prefetch" href="/assets/js/236.0f2e2794.js"><link rel="prefetch" href="/assets/js/237.c24a3987.js"><link rel="prefetch" href="/assets/js/238.24a8c123.js"><link rel="prefetch" href="/assets/js/239.ebbedd8a.js"><link rel="prefetch" href="/assets/js/24.65c88cda.js"><link rel="prefetch" href="/assets/js/240.61aa403a.js"><link rel="prefetch" href="/assets/js/241.40ae6a14.js"><link rel="prefetch" href="/assets/js/242.37049d18.js"><link rel="prefetch" href="/assets/js/243.8f6dabc9.js"><link rel="prefetch" href="/assets/js/244.00bcd6ce.js"><link rel="prefetch" href="/assets/js/245.2809b552.js"><link rel="prefetch" href="/assets/js/246.8b267a20.js"><link rel="prefetch" href="/assets/js/247.a67df8ec.js"><link rel="prefetch" href="/assets/js/248.4f26a33a.js"><link rel="prefetch" href="/assets/js/249.20bcad31.js"><link rel="prefetch" href="/assets/js/25.a1faceee.js"><link rel="prefetch" href="/assets/js/250.99917a60.js"><link rel="prefetch" href="/assets/js/251.bd763793.js"><link rel="prefetch" href="/assets/js/252.d301841d.js"><link rel="prefetch" href="/assets/js/253.8adc730c.js"><link rel="prefetch" href="/assets/js/254.7696fae3.js"><link rel="prefetch" href="/assets/js/255.dc87c295.js"><link rel="prefetch" href="/assets/js/256.b904c661.js"><link rel="prefetch" href="/assets/js/257.a6a4fd25.js"><link rel="prefetch" href="/assets/js/258.33e5aa35.js"><link rel="prefetch" href="/assets/js/259.412ed2c7.js"><link rel="prefetch" href="/assets/js/26.7af4b05a.js"><link rel="prefetch" href="/assets/js/260.52ff3c31.js"><link rel="prefetch" href="/assets/js/261.c2337769.js"><link rel="prefetch" href="/assets/js/262.0d9bfa34.js"><link rel="prefetch" href="/assets/js/263.c8e4cb6a.js"><link rel="prefetch" href="/assets/js/264.3464e615.js"><link rel="prefetch" href="/assets/js/265.5ef49004.js"><link rel="prefetch" href="/assets/js/27.d31fb32e.js"><link rel="prefetch" href="/assets/js/28.ac365b7a.js"><link rel="prefetch" href="/assets/js/29.4ec37ec1.js"><link rel="prefetch" href="/assets/js/30.8e31ec87.js"><link rel="prefetch" href="/assets/js/31.dbca7833.js"><link rel="prefetch" href="/assets/js/32.13f17495.js"><link rel="prefetch" href="/assets/js/33.84403c7c.js"><link rel="prefetch" href="/assets/js/34.ee01958a.js"><link rel="prefetch" href="/assets/js/35.ee834016.js"><link rel="prefetch" href="/assets/js/36.b27e2b58.js"><link rel="prefetch" href="/assets/js/37.5b9c6529.js"><link rel="prefetch" href="/assets/js/38.571abebc.js"><link rel="prefetch" href="/assets/js/39.7faebe0b.js"><link rel="prefetch" href="/assets/js/4.0a0c1c0f.js"><link rel="prefetch" href="/assets/js/40.c06ef95a.js"><link rel="prefetch" href="/assets/js/41.b1778bfc.js"><link rel="prefetch" href="/assets/js/42.a11eb5b9.js"><link rel="prefetch" href="/assets/js/43.dd5a39d2.js"><link rel="prefetch" href="/assets/js/44.e8f62cfa.js"><link rel="prefetch" href="/assets/js/45.019de3b4.js"><link rel="prefetch" href="/assets/js/46.4313681f.js"><link rel="prefetch" href="/assets/js/47.06396028.js"><link rel="prefetch" href="/assets/js/48.e77c89dd.js"><link rel="prefetch" href="/assets/js/49.a888c246.js"><link rel="prefetch" href="/assets/js/50.c81fd93d.js"><link rel="prefetch" href="/assets/js/51.ae7996b0.js"><link rel="prefetch" href="/assets/js/52.6aab4af3.js"><link rel="prefetch" href="/assets/js/53.0bb5c447.js"><link rel="prefetch" href="/assets/js/54.5ba7adba.js"><link rel="prefetch" href="/assets/js/55.d75ad9b1.js"><link rel="prefetch" href="/assets/js/56.a223d4a4.js"><link rel="prefetch" href="/assets/js/57.070c3d14.js"><link rel="prefetch" href="/assets/js/58.c07df3db.js"><link rel="prefetch" href="/assets/js/59.d468a048.js"><link rel="prefetch" href="/assets/js/6.2b00e463.js"><link rel="prefetch" href="/assets/js/60.0859ac91.js"><link rel="prefetch" href="/assets/js/61.ae4b86ed.js"><link rel="prefetch" href="/assets/js/62.e2e00ad4.js"><link rel="prefetch" href="/assets/js/63.ac9ed636.js"><link rel="prefetch" href="/assets/js/64.64603c0c.js"><link rel="prefetch" href="/assets/js/65.74bb2cbb.js"><link rel="prefetch" href="/assets/js/66.1758262f.js"><link rel="prefetch" href="/assets/js/67.5a3aa8f7.js"><link rel="prefetch" href="/assets/js/68.1c081375.js"><link rel="prefetch" href="/assets/js/69.c21e60d5.js"><link rel="prefetch" href="/assets/js/7.31d17e0f.js"><link rel="prefetch" href="/assets/js/70.8a74bf36.js"><link rel="prefetch" href="/assets/js/71.4492ba25.js"><link rel="prefetch" href="/assets/js/72.3296747e.js"><link rel="prefetch" href="/assets/js/73.c2a46fbe.js"><link rel="prefetch" href="/assets/js/74.366bddf4.js"><link rel="prefetch" href="/assets/js/75.e98af08c.js"><link rel="prefetch" href="/assets/js/76.c00e2544.js"><link rel="prefetch" href="/assets/js/77.a150a751.js"><link rel="prefetch" href="/assets/js/78.f3f879f6.js"><link rel="prefetch" href="/assets/js/79.da538e82.js"><link rel="prefetch" href="/assets/js/8.eb90e2e3.js"><link rel="prefetch" href="/assets/js/80.b1c3e778.js"><link rel="prefetch" href="/assets/js/81.3ca1bc6d.js"><link rel="prefetch" href="/assets/js/82.ca162a19.js"><link rel="prefetch" href="/assets/js/83.813d84be.js"><link rel="prefetch" href="/assets/js/85.dd4423c7.js"><link rel="prefetch" href="/assets/js/86.b25fb906.js"><link rel="prefetch" href="/assets/js/87.66be9b4e.js"><link rel="prefetch" href="/assets/js/88.eadaae8d.js"><link rel="prefetch" href="/assets/js/89.859e72b3.js"><link rel="prefetch" href="/assets/js/9.1d492be9.js"><link rel="prefetch" href="/assets/js/90.cfb6b7b9.js"><link rel="prefetch" href="/assets/js/91.e79aee5d.js"><link rel="prefetch" href="/assets/js/92.68903be5.js"><link rel="prefetch" href="/assets/js/93.60158657.js"><link rel="prefetch" href="/assets/js/94.d2105386.js"><link rel="prefetch" href="/assets/js/95.1c40abf7.js"><link rel="prefetch" href="/assets/js/96.97eb871e.js"><link rel="prefetch" href="/assets/js/97.787d5951.js"><link rel="prefetch" href="/assets/js/98.00721321.js"><link rel="prefetch" href="/assets/js/99.a689649e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.280b48f2.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/favicon1.png" alt="sunnyxujian's blog" class="logo"> <span class="site-name can-hide">sunnyxujian's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><a href="/basic/" class="link-title">前端基础</a> <span class="title" style="display:none;">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/prototype/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/pages/shoucang/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/pages/html/" class="nav-link">HTML和浏览器</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><a href="/framework/" class="link-title">框架</a> <span class="title" style="display:none;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/pages/vue3/" class="nav-link">Vue3</a></li><li class="dropdown-item"><!----> <a href="/pages/react/" class="nav-link">React</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><a href="/engineering/" class="link-title">工程化</a> <span class="title" style="display:none;">工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/engineering/modules/" class="nav-link">基础知识</a></li><li class="dropdown-item"><!----> <a href="/engineering/workflow/" class="nav-link">webpack</a></li><li class="dropdown-item"><!----> <a href="/engineering/rollup/" class="nav-link">rollup</a></li><li class="dropdown-item"><!----> <a href="/engineering/vite/" class="nav-link">vite</a></li><li class="dropdown-item"><!----> <a href="/engineering/betterConsole/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端进阶" class="dropdown-title"><a href="/advanced/" class="link-title">前端进阶</a> <span class="title" style="display:none;">前端进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/advanced/nodejs/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/advanced/net/" class="nav-link">网络</a></li><li class="dropdown-item"><!----> <a href="/advanced/typescript/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/advanced/codedesign/" class="nav-link">架构设计</a></li><li class="dropdown-item"><!----> <a href="/advanced/optimize/" class="nav-link">性能优化</a></li><li class="dropdown-item"><!----> <a href="/advanced/algorithms/" class="nav-link">数据结构和算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><a href="/notes/" class="link-title">学习笔记</a> <span class="title" style="display:none;">学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/javascript/" class="nav-link">JavaScript教程 笔记</a></li><li class="dropdown-item"><!----> <a href="/notes/es6/" class="nav-link">ES6 教程 笔记</a></li><li class="dropdown-item"><!----> <a href="/notes/typescript-axios/" class="nav-link">TypeScript 从零实现 axios</a></li><li class="dropdown-item"><!----> <a href="/notes/git/" class="nav-link">Git学习 笔记</a></li><li class="dropdown-item"><!----> <a href="/notes/render/" class="nav-link">渲染器原理</a></li><li class="dropdown-item"><!----> <a href="/notes/typeScript/" class="nav-link">TypeScript 笔记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他技术" class="dropdown-title"><a href="/technology/" class="link-title">其他技术</a> <span class="title" style="display:none;">其他技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/techDocs/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/githubUseage/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><a href="/pages/techSite/" class="link-title">收藏</a> <span class="title" style="display:none;">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/techSite/" class="nav-link">网站</a></li><li class="dropdown-item"><!----> <a href="/pages/usefulSite/" class="nav-link">资源</a></li><li class="dropdown-item"><!----> <a href="/pages/vueSource/" class="nav-link">Vue资源</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="友链&amp;关于" class="dropdown-title"><a href="/friends/" class="link-title">友链&amp;关于</a> <span class="title" style="display:none;">友链&amp;关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友链</a></li><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">关于</a></li></ul></div></div> <a href="https://github.com//sunnyxujian" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://xj-1253772569.file.myqcloud.com/img/mona-loading-default.gif"> <div class="blogger-info"><h3>xujian</h3> <span>劝君惜取少年时。</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><a href="/basic/" class="link-title">前端基础</a> <span class="title" style="display:none;">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/prototype/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/pages/shoucang/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/pages/html/" class="nav-link">HTML和浏览器</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架" class="dropdown-title"><a href="/framework/" class="link-title">框架</a> <span class="title" style="display:none;">框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/vue/" class="nav-link">Vue</a></li><li class="dropdown-item"><!----> <a href="/pages/vue3/" class="nav-link">Vue3</a></li><li class="dropdown-item"><!----> <a href="/pages/react/" class="nav-link">React</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><a href="/engineering/" class="link-title">工程化</a> <span class="title" style="display:none;">工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/engineering/modules/" class="nav-link">基础知识</a></li><li class="dropdown-item"><!----> <a href="/engineering/workflow/" class="nav-link">webpack</a></li><li class="dropdown-item"><!----> <a href="/engineering/rollup/" class="nav-link">rollup</a></li><li class="dropdown-item"><!----> <a href="/engineering/vite/" class="nav-link">vite</a></li><li class="dropdown-item"><!----> <a href="/engineering/betterConsole/" class="nav-link">其他</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端进阶" class="dropdown-title"><a href="/advanced/" class="link-title">前端进阶</a> <span class="title" style="display:none;">前端进阶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/advanced/nodejs/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/advanced/net/" class="nav-link">网络</a></li><li class="dropdown-item"><!----> <a href="/advanced/typescript/" class="nav-link">TypeScript</a></li><li class="dropdown-item"><!----> <a href="/advanced/codedesign/" class="nav-link">架构设计</a></li><li class="dropdown-item"><!----> <a href="/advanced/optimize/" class="nav-link">性能优化</a></li><li class="dropdown-item"><!----> <a href="/advanced/algorithms/" class="nav-link">数据结构和算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习笔记" class="dropdown-title"><a href="/notes/" class="link-title">学习笔记</a> <span class="title" style="display:none;">学习笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notes/javascript/" class="nav-link">JavaScript教程 笔记</a></li><li class="dropdown-item"><!----> <a href="/notes/es6/" class="nav-link">ES6 教程 笔记</a></li><li class="dropdown-item"><!----> <a href="/notes/typescript-axios/" class="nav-link">TypeScript 从零实现 axios</a></li><li class="dropdown-item"><!----> <a href="/notes/git/" class="nav-link">Git学习 笔记</a></li><li class="dropdown-item"><!----> <a href="/notes/render/" class="nav-link">渲染器原理</a></li><li class="dropdown-item"><!----> <a href="/notes/typeScript/" class="nav-link">TypeScript 笔记</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他技术" class="dropdown-title"><a href="/technology/" class="link-title">其他技术</a> <span class="title" style="display:none;">其他技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/techDocs/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/githubUseage/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/41f87d890d0a02af/" class="nav-link">博客搭建</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="收藏" class="dropdown-title"><a href="/pages/techSite/" class="link-title">收藏</a> <span class="title" style="display:none;">收藏</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/techSite/" class="nav-link">网站</a></li><li class="dropdown-item"><!----> <a href="/pages/usefulSite/" class="nav-link">资源</a></li><li class="dropdown-item"><!----> <a href="/pages/vueSource/" class="nav-link">Vue资源</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="友链&amp;关于" class="dropdown-title"><a href="/friends/" class="link-title">友链&amp;关于</a> <span class="title" style="display:none;">友链&amp;关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友链</a></li><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">关于</a></li></ul></div></div> <a href="https://github.com//sunnyxujian" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础知识</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>rollup</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/engineering/rollup/" class="sidebar-link">rollup基础用法</a></li><li><a href="/pages/d5d86e/" class="sidebar-link">手写rollup原理</a></li><li><a href="/pages/901a78/" aria-current="page" class="active sidebar-link">rollup插件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/901a78/#_1-rollup插件调试方法" class="sidebar-link">1. rollup插件调试方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/901a78/#_1-1-debugger-js" class="sidebar-link">1.1 debugger.js</a></li><li class="sidebar-sub-header"><a href="/pages/901a78/#_1-2-rollup-config-js" class="sidebar-link">1.2 rollup.config.js</a></li><li class="sidebar-sub-header"><a href="/pages/901a78/#_1-3-package-json" class="sidebar-link">1.3 package.json</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/901a78/#_2-rollup插件" class="sidebar-link">2. rollup插件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/901a78/#_2-1-插件规范" class="sidebar-link">2.1 插件规范</a></li><li class="sidebar-sub-header"><a href="/pages/901a78/#_2-2-插件属性" class="sidebar-link">2.2.插件属性</a></li><li class="sidebar-sub-header"><a href="/pages/901a78/#_2-2-build-hooks" class="sidebar-link">2.2 Build Hooks</a></li><li class="sidebar-sub-header"><a href="/pages/901a78/#_2-3-output-generation-hooks" class="sidebar-link">2.3 Output Generation Hooks</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/901a78/#_3-plugin-context-插件上下文" class="sidebar-link">3.Plugin Context 插件上下文</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/901a78/#_3-1-this-emitfile" class="sidebar-link">3.1 this.emitFile</a></li><li class="sidebar-sub-header"><a href="/pages/901a78/#_3-2-this-getmoduleinfo" class="sidebar-link">3.2 this.getmoduleinfo</a></li><li class="sidebar-sub-header"><a href="/pages/901a78/#_3-3-this-load" class="sidebar-link">3.3 this.load</a></li><li class="sidebar-sub-header"><a href="/pages/901a78/#_3-4-this-resolve" class="sidebar-link">3.4 this.resolve</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/901a78/#_4-实战案例" class="sidebar-link">4.实战案例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/901a78/#_4-1-rollup-plugin-babel" class="sidebar-link">4.1 @rollup/plugin-babel</a></li><li class="sidebar-sub-header"><a href="/pages/901a78/#_4-2-rollup-plugin-commonjs" class="sidebar-link">4.2 @rollup/plugin-commonjs</a></li><li class="sidebar-sub-header"><a href="/pages/901a78/#_4-3-rollup-plugin-node-resolve" class="sidebar-link">4.3 @rollup/plugin-node-resolve</a></li><li class="sidebar-sub-header"><a href="/pages/901a78/#_4-4-rollup-plugin-alias" class="sidebar-link">4.4 @rollup/plugin-alias</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vite</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>其他</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-583ea4e9><div class="articleInfo" data-v-583ea4e9><ul class="breadcrumbs" data-v-583ea4e9><li data-v-583ea4e9><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-583ea4e9></a></li> <li data-v-583ea4e9><a href="/engineering" title="工程化-目录页" data-v-583ea4e9>工程化</a></li> <li data-v-583ea4e9><a href="/engineering/#rollup" title="工程化#rollup" data-v-583ea4e9>rollup</a></li> <!----></ul> <div class="info" data-v-583ea4e9><div title="作者" class="author iconfont icon-touxiang" data-v-583ea4e9><a href="https://github.com/sunnyxujian" target="_blank" title="作者" class="beLink" data-v-583ea4e9>xujian</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-583ea4e9><a href="javascript:;" data-v-583ea4e9>2022-05-18</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">
          rollup插件
        </h1> <!----> <div class="theme-vdoing-content content__default"><p><code>Rollup</code>是一个<code>JavaScript</code>模块打包器，可以将小块代码编译成大块复杂的代码，打包出来的代码十分美观。特别适合框架和库的打包。rollup插件写起来也十分方便，提供了构建hooks、生成hooks、插件上下文，便于控制打包过程和构建结果。</p> <h2 id="_1-rollup插件调试方法"><a href="#_1-rollup插件调试方法" class="header-anchor">#</a> 1. rollup插件调试方法</h2> <h3 id="_1-1-debugger-js"><a href="#_1-1-debugger-js" class="header-anchor">#</a> 1.1 debugger.js</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> rollup<span class="token punctuation">,</span> watch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rollup'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> inputOptions <span class="token keyword">from</span> <span class="token string">'./rollup.config.js'</span>
  <span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//打包阶段 </span>
    <span class="token keyword">const</span> bundle <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">rollup</span><span class="token punctuation">(</span>inputOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//生成阶段`</span>
    <span class="token keyword">await</span> bundle<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span>inputOptions<span class="token punctuation">.</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//写入阶段</span>
    <span class="token keyword">await</span> bundle<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>inputOptions<span class="token punctuation">.</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* 
    const watcher = watch(inputOptions);
    watcher.on('event', event =&gt; {
      console.log(event);
    });
    setTimeout(() =&gt; {
      watcher.close();
    }, 1000); */</span>
    <span class="token comment">//关闭阶段</span>
    <span class="token keyword">await</span> bundle<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="_1-2-rollup-config-js"><a href="#_1-2-rollup-config-js" class="header-anchor">#</a> 1.2 rollup.config.js</h3> <p>rollup.config.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">dir</span><span class="token operator">:</span> <span class="token string">'dist'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_1-3-package-json"><a href="#_1-3-package-json" class="header-anchor">#</a> 1.3 package.json</h3> <p>package.json</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rollup -c&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_2-rollup插件"><a href="#_2-rollup插件" class="header-anchor">#</a> 2. rollup插件</h2> <ul><li><a href="https://rollupjs.org/guide/en/#plugins-overview" target="_blank" rel="noopener noreferrer">Rollup 插件<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>是一个具有以下描述的一个或多个<code>属性</code>、<code>构建钩子</code>和<code>输出生成钩子</code>的对象，它遵循我们的约定。插件应该作为一个包分发，该包导出一个可以使用插件特定选项调用的函数并返回这样一个对象</li></ul> <blockquote><p><a href="https://github.com/rollup/awesome" target="_blank" rel="noopener noreferrer">常用插件列表<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="_2-1-插件规范"><a href="#_2-1-插件规范" class="header-anchor">#</a> 2.1 插件规范</h3> <ul><li>插件应该有一个清晰的名称，带有<code>rollup-plugin-prefix</code></li> <li>在package.json中包含插件关键字</li> <li>插件应该经过测试。我们推荐mocha或ava，它们支持开箱即用的Promise</li> <li>尽可能使用异步方法。</li> <li>编写英文文档</li> <li>如果合适的话，确保你的插件输出正确的<code>sourcemap</code></li> <li>如果您的插件使用“虚拟模块”（例如，用于辅助功能），请在模块ID前面加上<code>\0</code>。这会阻止其他插件尝试处理它</li></ul> <h3 id="_2-2-插件属性"><a href="#_2-2-插件属性" class="header-anchor">#</a> 2.2.插件属性</h3> <h4 id="_2-2-1-name"><a href="#_2-2-1-name" class="header-anchor">#</a> 2.2.1 name</h4> <ul><li>插件的名称，用于错误消息和警告</li> <li>Type: 字符串</li></ul> <h3 id="_2-2-build-hooks"><a href="#_2-2-build-hooks" class="header-anchor">#</a> 2.2 Build Hooks</h3> <ul><li>为了与构建过程交互，你的插件对象包括“钩子”</li> <li>钩子是在构建的不同阶段调用的函数</li> <li>钩子可以影响构建的运行方式，提供关于构建的信息，或者在构建完成后修改构建</li> <li>有不同种类的钩子
<ul><li><code>async</code> 钩子还可以返回解析为相同类型值的<code>Promise</code>；否则，钩子将被标记为<code>sync</code></li> <li><code>first</code> 如果有几个插件实现了这个钩子，钩子会按顺序运行，直到钩子返回一个<code>非null</code>或未定义的值</li> <li><code>sequential</code> 如果几个插件实现了这个钩子，那么它们都将按照指定的插件顺序运行。如果一个钩子是异步的，那么这种类型的后续钩子将等待当前钩子被解析</li> <li><code>parallel</code> 如果多个插件实现了这个钩子，那么它们都将按照指定的插件顺序运行。如果一个钩子是异步的，那么这类后续钩子将并行运行，而不是等待当前钩子</li></ul></li> <li><code>Build Hooks</code>在构建阶段运行，该阶段由<code>rollup.rollup(inputOptions)</code>触发</li> <li>它们主要负责在<code>rollup</code>处理输入文件之前定位、提供和转换输入文件</li> <li>构建阶段的第一个钩子是<code>options</code>，最后一个钩子总是<code>buildEnd</code></li> <li>如果出现生成错误，将在此之后调用<code>closeBundle</code></li></ul> <p><strong>build流程：</strong><br> <img src="https://xj-1253772569.file.myqcloud.com/assets/build-workflow.png" alt="build-workflow"></p> <h4 id="_2-2-1-rollup-plugin-build-js"><a href="#_2-2-1-rollup-plugin-build-js" class="header-anchor">#</a> 2.2.1 rollup-plugin-build.js</h4> <p>plugins\rollup-plugin-build.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> fs <span class="token keyword">from</span> <span class="token string">'fs'</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'build'</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">watchChange</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> change</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'watchChange'</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> change<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">closeWatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'closeWatcher'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">options</span><span class="token punctuation">(</span><span class="token parameter">inputOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'options'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//inputOptions.input = './src/main.js';</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">buildStart</span><span class="token punctuation">(</span><span class="token parameter">inputOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'buildStart'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">resolveId</span><span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span> importer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token operator">===</span> <span class="token string">'virtual'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resolveId'</span><span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//如果resolveId钩子有返回值了，那么就会跳过后面的查找逻辑，以此返回值作为最终的模块ID</span>
        <span class="token keyword">return</span> source<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//加载此模块ID对应的内容</span>
    <span class="token keyword">async</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">===</span> <span class="token string">'virtual'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export default &quot;virtual&quot;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">shouldTransformCachedModule</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> id<span class="token punctuation">,</span> code<span class="token punctuation">,</span> ast <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'shouldTransformCachedModule'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//不使用缓存，再次进行转换</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'transform'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">moduleParsed</span><span class="token punctuation">(</span><span class="token parameter">moduleInfo</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'moduleParsed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">resolveDynamicImport</span><span class="token punctuation">(</span><span class="token parameter">specifier<span class="token punctuation">,</span> importer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resolveDynamicImport'</span><span class="token punctuation">,</span> specifier<span class="token punctuation">,</span> importer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">buildEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'buildEnd'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> build<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h4 id="_2-2-2-rollup-config-js"><a href="#_2-2-2-rollup-config-js" class="header-anchor">#</a> 2.2.2 rollup.config.js</h4> <p>rollup.config.js</p> <div class="language-diff line-numbers-mode"><pre class="language-diff"><code><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import build from './plugins/rollup-plugin-build.js';
</span></span>export default {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> input: &quot;./src/index.js&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line"> output: [{
</span><span class="token prefix unchanged"> </span><span class="token line">   dir: 'dist',
</span><span class="token prefix unchanged"> </span><span class="token line"> }],
</span><span class="token prefix unchanged"> </span><span class="token line"> plugins: [
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   build()
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> ]
</span></span>}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="_2-2-3-options"><a href="#_2-2-3-options" class="header-anchor">#</a> 2.2.3 options</h4> <blockquote><p><a href="https://rollupjs.org/guide/en/#big-list-of-options" target="_blank" rel="noopener noreferrer">big-list-of-options<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th> <th></th></tr></thead> <tbody><tr><td style="text-align:left;">Type</td> <td style="text-align:left;">(options: InputOptions) =&gt; InputOptions</td> <td>null</td></tr> <tr><td style="text-align:left;">Kind</td> <td style="text-align:left;">async, sequential</td> <td></td></tr> <tr><td style="text-align:left;">Previous Hook</td> <td style="text-align:left;">这是构建阶段的第一个钩子</td> <td></td></tr> <tr><td style="text-align:left;">Next Hook</td> <td style="text-align:left;">buildStart</td> <td></td></tr></tbody></table> <ul><li>替换或操作传递给<code>rollup</code>的选项对象</li> <li>返回<code>null</code>的话rollup不会替换任何内容</li> <li>如果只需要阅读<code>options</code>，建议使用<code>buildStart</code>钩子，因为在考虑了所有选项钩子的转换后，该钩子可以访问选项</li> <li>这是唯一一个无法访问大多数插件上下文实用程序功能的钩子，因为它是在完全配置汇总之前运行的</li></ul> <h4 id="_2-2-4-buildstart"><a href="#_2-2-4-buildstart" class="header-anchor">#</a> 2.2.4 buildStart</h4> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th></tr></thead> <tbody><tr><td style="text-align:left;">Type</td> <td style="text-align:left;">(options: InputOptions) =&gt; void</td></tr> <tr><td style="text-align:left;">Kind</td> <td style="text-align:left;">async, parallel</td></tr> <tr><td style="text-align:left;">Previous Hook</td> <td style="text-align:left;">options</td></tr> <tr><td style="text-align:left;">Next Hook</td> <td style="text-align:left;">resolveId并行解析每个入口点</td></tr></tbody></table> <ul><li>每次<code>rollup.rollup build</code>都要调用此钩子</li> <li>当您需要访问传递给rollup的选项时，建议使用这个钩子</li> <li>因为它考虑了所有<code>options</code>钩子的转换，还包含未设置选项的正确默认值</li></ul> <p>build\plugin-buildStart.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">buildStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'buildStart'</span><span class="token punctuation">,</span>
    <span class="token function">buildStart</span><span class="token punctuation">(</span><span class="token parameter">InputOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'buildStart'</span><span class="token punctuation">,</span> InputOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_2-2-5-resolveid"><a href="#_2-2-5-resolveid" class="header-anchor">#</a> 2.2.5 resolveId</h4> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th> <th></th> <th></th></tr></thead> <tbody><tr><td style="text-align:left;">Type</td> <td style="text-align:left;">(source, importer) =&gt; string</td> <td>false</td> <td>null</td></tr> <tr><td style="text-align:left;">Kind</td> <td style="text-align:left;">async, first</td> <td></td> <td></td></tr> <tr><td style="text-align:left;">Previous Hook</td> <td style="text-align:left;"><code>buildStart</code>(如果我们正在解析入口点)，<code>moduleParsed</code>（如果我们正在解析导入），或者作为<code>resolveDynamicImport</code>的后备方案。此外，这个钩子可以在构建阶段通过调用插件钩子触发。<code>emitFile</code>发出一个入口点，或在任何时候通过调用此。<code>resolve</code>可手动解析id</td> <td></td> <td></td></tr> <tr><td style="text-align:left;">Next Hook</td> <td style="text-align:left;">如果解析的<code>id</code>尚未加载，则<code>load</code>，否则<code>buildEnd</code></td> <td></td> <td></td></tr></tbody></table> <ul><li><p>定义自定义解析器</p></li> <li><p>解析程序可用于定位第三方依赖关系等。这里<code>source</code>是导入语句中所写的导入对象，即</p></li> <li><p>来源就是 <code>&quot;../bar.js&quot;</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> foo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../bar.js'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>importer</code>是导入模块的完全解析id</p></li> <li><p>在解析入口点时，<code>importer</code>通常是undefined</p></li> <li><p>这里的一个例外是通过<code>this.emitFile</code>生成的入口点。在这里，您可以提供一个<code>importer</code>参数</p></li> <li><p>对于这些情况，<code>isEntry</code>选项将告诉您，我们是否正在解析用户定义的入口点、发出的块，或者是否为此提供了<code>isEntry</code>参数。解析上下文函数</p></li> <li><p>例如，您可以将其用作为入口点定义自定义代理模块的机制。以下插件将代理所有入口点以注入<code>polyfill</code>导入</p></li> <li><p>返回<code>null</code>将遵循其他<code>resolveId</code>函数，最终遵循默认的解析行</p></li> <li><p>返回<code>false</code>信号，表示源应被视为<code>外部模块</code>，不包括在<code>bundle</code>中</p></li></ul> <p>index.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> virtual <span class="token keyword">from</span> <span class="token string">'virtual-module'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>virtual<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>build\plugin-polyfill.js</strong></p> <blockquote><p>自动在main.js注入 polyfill 文件的插件</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//我们在polyfill id前面加上\0，告诉其他插件不要尝试加载或转换它</span>
<span class="token keyword">const</span> <span class="token constant">POLYFILL_ID</span> <span class="token operator">=</span> <span class="token string">'\0polyfill'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">PROXY_SUFFIX</span> <span class="token operator">=</span> <span class="token string">'?inject-polyfill-proxy'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">injectPolyfillPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'inject-polyfill'</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">resolveId</span><span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span> importer<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token operator">===</span> <span class="token constant">POLYFILL_ID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//重要的是，对于polyfills，应始终考虑副作用</span>
        <span class="token comment">//否则，使用`treeshake.moduleSideEffects:false`可能会阻止包含polyfill</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token constant">POLYFILL_ID</span><span class="token punctuation">,</span> <span class="token literal-property property">moduleSideEffects</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>isEntry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//确定实际的入口是什么。我们需要skipSelf来避免无限循环。</span>
        <span class="token keyword">const</span> resolution <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> importer<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">skipSelf</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token operator">...</span>options <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//如果它无法解决或是外部的，只需返回它，这样Rollup就可以显示错误</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>resolution <span class="token operator">||</span> resolution<span class="token punctuation">.</span>external<span class="token punctuation">)</span> <span class="token keyword">return</span> resolution<span class="token punctuation">;</span>
        <span class="token comment">//在代理的加载钩子中，我们需要知道入口是否有默认导出</span>
        <span class="token comment">//然而，在那里，我们不再有完整的“解析”对象，它可能包含来自其他插件的元数据，这些插件只在第一次加载时添加</span>
        <span class="token comment">//仅在第一次加载时添加。因此我们在这里触发加载。</span>
        <span class="token keyword">const</span> moduleInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>resolution<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//我们需要确保即使对于treeshake来说，原始入口点的副作用也得到了考虑。moduleSideEffects:false。</span>
        <span class="token comment">//moduleSideEffects是ModuleInfo上的一个可写属性</span>
        moduleInfo<span class="token punctuation">.</span>moduleSideEffects <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token comment">//重要的是，新入口不能以\0开头，并且与原始入口具有相同的目录，以免扰乱相对外部导入的生成</span>
        <span class="token comment">//此外，保留名称并在末尾添加一个“？查询”可以确保preserveModules将为该条目生成原始条目名称</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>resolution<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">PROXY_SUFFIX</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">===</span> <span class="token constant">POLYFILL_ID</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 替换为实际的polyfill import '@babel/polyfill'</span>
        <span class="token keyword">return</span> <span class="token string">&quot;console.log('polyfill');&quot;</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token constant">PROXY_SUFFIX</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> entryId <span class="token operator">=</span> id<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token constant">PROXY_SUFFIX</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//我们知道ModuleInfo.hasDefaultExport是可靠的，因为我们在等待在resolveId中的this.load</span>
        <span class="token comment">// We know ModuleInfo.hasDefaultExport is reliable because we awaited this.load in resolveId</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> hasDefaultExport <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getModuleInfo</span><span class="token punctuation">(</span>entryId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> code <span class="token operator">=</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">import </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token constant">POLYFILL_ID</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export * from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>entryId<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token comment">//命名空间重新导出不会重新导出默认值，因此我们需要在这里进行特殊处理</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>hasDefaultExport<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          code <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export { default } from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>entryId<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> code<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><h4 id="_2-2-6-load"><a href="#_2-2-6-load" class="header-anchor">#</a> 2.2.6 load</h4> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th> <th></th></tr></thead> <tbody><tr><td style="text-align:left;"></td> <td style="text-align:left;">(id) =&gt; string</td> <td>null</td></tr> <tr><td style="text-align:left;">Kind</td> <td style="text-align:left;">async, first</td> <td></td></tr> <tr><td style="text-align:left;">Previous Hook</td> <td style="text-align:left;">解析加载id的<code>resolveId</code>或<code>resolveDynamicImport</code>。此外，这个钩子可以在任何时候从插件钩子中通过调用<code>this.load</code>来触发预加载与id对应的模块</td> <td></td></tr> <tr><td style="text-align:left;">Next Hook</td> <td style="text-align:left;"><code>transform</code>可在未使用缓存或没有使用相同代码的缓存副本时转换加载的文件，否则应使用<code>TransformCachedModule</code></td> <td></td></tr></tbody></table> <ul><li>定义自定义加载程序</li> <li>返回<code>null</code>会推迟到其他加载函数（最终是从文件系统加载的默认行为）</li> <li>为了防止额外的解析开销，例如这个钩子已经使用了这个。parse出于某种原因，为了生成AST，这个钩子可以选择性地返回<code>{code，AST，map}</code>对象。<code>ast</code>必须是标准的<code>ESTree ast</code>，每个节点都有开始和结束属性。如果转换不移动代码，可以通过将map设置为null来保留现有的sourcemaps。否则，您可能需要生成源映射。请参阅关于源代码转换的部分</li></ul> <h4 id="_2-2-7-transform"><a href="#_2-2-7-transform" class="header-anchor">#</a> 2.2.7 transform</h4> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th></tr></thead> <tbody><tr><td style="text-align:left;">Type</td> <td style="text-align:left;">(code, id) =&gt; string</td></tr> <tr><td style="text-align:left;">Kind</td> <td style="text-align:left;">async, sequential</td></tr> <tr><td style="text-align:left;">Previous Hook</td> <td style="text-align:left;"><code>load</code> 当前处理的文件的位置。如果使用了缓存，并且有该模块的缓存副本，那么如果插件为该钩子返回true，则应<code>shouldTransformCachedModule</code></td></tr> <tr><td style="text-align:left;">Next Hook</td> <td style="text-align:left;"><code>moduleParsed</code> 一旦文件被处理和解析，模块就会被解析</td></tr></tbody></table> <ul><li>可用于转换单个模块</li> <li>为了防止额外的解析开销，例如这个钩子已经使用了<code>this.parse</code>出于某种原因，为了生成AST</li> <li>这个钩子可以选择性地返回<code>{code，AST，map}</code>对象</li> <li>ast必须是标准的ESTree ast，每个节点都有<code>start</code>和<code>end</code>属性</li> <li>如果转换不移动代码，可以通过将map设置为null来保留现有的sourcemaps。否则，您可能需要生成源映射。请参阅关于源代码转换的部分</li></ul> <p>plugins\rollup-plugin-babel.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createFilter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rollup-pluginutils'</span>
<span class="token keyword">import</span> babel <span class="token keyword">from</span> <span class="token string">'@babel/core'</span>
<span class="token keyword">function</span> <span class="token function">plugin</span><span class="token punctuation">(</span><span class="token parameter">pluginOptions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> defaultExtensions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.jsx'</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> exclude<span class="token punctuation">,</span> include<span class="token punctuation">,</span> extensions <span class="token operator">=</span> defaultExtensions <span class="token punctuation">}</span> <span class="token operator">=</span> pluginOptions<span class="token punctuation">;</span>
  <span class="token keyword">const</span> extensionRegExp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>extensions<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)$</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> userDefinedFilter <span class="token operator">=</span> <span class="token function">createFilter</span><span class="token punctuation">(</span>include<span class="token punctuation">,</span> exclude<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">filter</span> <span class="token operator">=</span> <span class="token parameter">id</span> <span class="token operator">=&gt;</span> extensionRegExp<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">userDefinedFilter</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'babel'</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">filter</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> babel<span class="token punctuation">.</span><span class="token function">transformAsync</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> result
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> plugin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="_2-2-8-shouldtransformcachedmodule"><a href="#_2-2-8-shouldtransformcachedmodule" class="header-anchor">#</a> 2.2.8 shouldTransformCachedModule</h4> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th></tr></thead> <tbody><tr><td style="text-align:left;">Type</td> <td style="text-align:left;">({id, code, ast, resoledSources, moduleSideEffects, syntheticNamedExports) =&gt; boolean</td></tr> <tr><td style="text-align:left;">Kind: async, first</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">Previous Hook</td> <td style="text-align:left;"><code>load</code> 加载缓存文件以将其代码与缓存版本进行比较的位置</td></tr> <tr><td style="text-align:left;">Next Hook</td> <td style="text-align:left;"><code>moduleParsed</code> if no plugin returns true, otherwise <code>transform</code>.</td></tr></tbody></table> <ul><li>如果使用了<code>Rollup</code>缓存（例如，在监视模式下或通过JavaScript API显式使用），如果在加载钩子之后，加载的代码与缓存副本的代码相同，则Rollup将跳过模块的转换钩子</li> <li>为了防止这种情况，丢弃缓存的副本，而是转换一个模块，插件可以实现这个钩子并返回true。</li> <li>这个钩子还可以用来找出缓存了哪些模块，并访问它们缓存的元信息</li> <li>如果一个插件没有返回true，Rollup将触发其他插件的这个钩子，否则将跳过所有剩余的插件。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>npx rollup <span class="token operator">-</span>c <span class="token operator">-</span>w
shouldTransformCachedModule
transform
moduleParsed

shouldTransformCachedModule
moduleParsed
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_2-2-9-moduleparsed"><a href="#_2-2-9-moduleparsed" class="header-anchor">#</a> 2.2.9 moduleParsed</h4> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th></tr></thead> <tbody><tr><td style="text-align:left;">Type</td> <td style="text-align:left;">(moduleInfo: ModuleInfo) =&gt; void</td></tr> <tr><td style="text-align:left;">Kind: async, parallel</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">Previous Hook</td> <td style="text-align:left;"><code>transform</code> 转换当前处理的文件的位置</td></tr> <tr><td style="text-align:left;">Next Hook</td> <td style="text-align:left;"><code>resolveId</code> 和 <code>resolveDynamicImport</code> 并行解析所有发现的静态和动态导入（如果存在），否则buildEnd</td></tr></tbody></table> <ul><li>每当模块被<code>Rollup</code>完全解析时，就会调用这个钩子。看看<code>this.getModuleInfo</code>了解传递给这个钩子的信息</li> <li>与<code>transform</code>钩子不同，这个钩子从不缓存，可以用来获取缓存模块和其他模块的信息，包括元属性的最终形状、代码和ast</li></ul> <h4 id="_2-2-10-resolvedynamicimport"><a href="#_2-2-10-resolvedynamicimport" class="header-anchor">#</a> 2.2.10 resolveDynamicImport</h4> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th></tr></thead> <tbody><tr><td style="text-align:left;">Type</td> <td style="text-align:left;">(specifier, importer) =&gt; string</td></tr> <tr><td style="text-align:left;">Kind</td> <td style="text-align:left;">async, first</td></tr> <tr><td style="text-align:left;">Previous Hook</td> <td style="text-align:left;"><code>moduleParsed</code> 已为导入文件分配模块</td></tr> <tr><td style="text-align:left;">Next Hook</td> <td style="text-align:left;"><code>load</code> 如果钩子使用尚未加载的id ,如果动态导入包含字符串且钩子未解析，请加载<code>resolveId</code>，否则为<code>buildEnd</code></td></tr></tbody></table> <ul><li>为动态导入定义自定义解析程序</li> <li>返回<code>false</code>表明导入应该保持原样，而不是传递给其他解析程序，从而使其成为外部的</li> <li>与<code>resolveId</code>钩子类似，还可以返回一个对象，将导入解析为不同的id，同时将其标记为外部</li> <li>如果动态导入被传递一个字符串作为参数，那么从这个钩子返回的字符串将被解释为一个现有的模块id，而返回null将推迟到其它解析器resolveId</li></ul> <p>index.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./msg.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_2-2-11-buildend"><a href="#_2-2-11-buildend" class="header-anchor">#</a> 2.2.11 buildEnd</h4> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th></tr></thead> <tbody><tr><td style="text-align:left;">Type</td> <td style="text-align:left;">(error) =&gt; void</td></tr> <tr><td style="text-align:left;">Kind</td> <td style="text-align:left;">async, parallel</td></tr> <tr><td style="text-align:left;">Previous Hook</td> <td style="text-align:left;">moduleParsed, resolveId or resolveDynamicImport.</td></tr> <tr><td style="text-align:left;">Next Hook</td> <td style="text-align:left;">outputOptions 输出生成阶段的输出，因为这是构建阶段的最后一个挂钩</td></tr></tbody></table> <ul><li>在<code>rollup</code>完成打包时调用，但在调用<code>generate</code>或<code>write</code>之前调用；你也可以返回一个<code>Promise</code></li> <li>如果在构建过程中发生错误，则会将其传递给此钩子</li></ul> <h3 id="_2-3-output-generation-hooks"><a href="#_2-3-output-generation-hooks" class="header-anchor">#</a> 2.3 Output Generation Hooks</h3> <ul><li>输出生成钩子可以提供有关生成的包的信息，并在完成后修改构建</li> <li>输出生成阶段的第一个钩子是<code>outputOptions</code>，最后一个钩子要么<code>generateBundle</code>是通过成功生成输出</li> <li>或者在输出生成过程中的任何时候发生错误 <code>renderError</code></li> <li>此外，<code>closeBundle</code>可以作为最后一个钩子调用，但用户有责任手动调用<code>bundle.close()</code>以触发此钩子</li></ul> <p><strong>构建生成流程：</strong></p> <p><img src="https://xj-1253772569.file.myqcloud.com/assets/gen-workflow.png" alt="gen-workflow"></p> <h4 id="_2-3-1-rollup-plugin-generation-js"><a href="#_2-3-1-rollup-plugin-generation-js" class="header-anchor">#</a> 2.3.1 rollup-plugin-generation.js</h4> <p>plugins\rollup-plugin-generation.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">generation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'rollup-plugin-generation'</span><span class="token punctuation">,</span>
    <span class="token comment">//这个钩子是同步的，不能加async</span>
    <span class="token function">outputOptions</span><span class="token punctuation">(</span><span class="token parameter">outputOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'outputOptions'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">renderStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'renderStart'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">banner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'banner'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">footer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'footer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">intro</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'intro'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">outro</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'outro'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">renderDynamicImport</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'renderDynamicImport'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">augmentChunkHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'augmentChunkHash'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">resolveFileUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resolveFileUrl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">resolveImportMeta</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'resolveImportMeta'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">renderChunk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'renderChunk'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">generateBundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'generateBundle'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">writeBundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'writeBundle'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">renderError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'renderError'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">closeBundle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'closeBundle'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> generation<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h4 id="_2-3-2-rollup-config-js"><a href="#_2-3-2-rollup-config-js" class="header-anchor">#</a> 2.3.2 rollup.config.js</h4> <p>rollup.config.js</p> <div class="language-diff line-numbers-mode"><pre class="language-diff"><code>import build from './plugins/rollup-plugin-build.js';
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import generation from './plugins/rollup-plugin-generation.js';
</span></span>export default {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> input: &quot;./src/index.js&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line"> output: [{
</span><span class="token prefix unchanged"> </span><span class="token line">   dir: 'dist',
</span><span class="token prefix unchanged"> </span><span class="token line"> }],
</span><span class="token prefix unchanged"> </span><span class="token line"> plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">   build(),
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   generation()
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> ]
</span></span>}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_2-3-3-outputoptions"><a href="#_2-3-3-outputoptions" class="header-anchor">#</a> 2.3.3 outputOptions</h4> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th></tr></thead> <tbody><tr><td style="text-align:left;">Type</td> <td style="text-align:left;">(outputOptions) =&gt; null</td></tr> <tr><td style="text-align:left;">Kind</td> <td style="text-align:left;">async, parallel</td></tr> <tr><td style="text-align:left;">Previous Hook</td> <td style="text-align:left;"><code>buildEnd</code>如果这是第一次生成输出，否则为<code>generateBundle</code>，<code>writeBundle</code>或<code>renderError</code>取决于先前生成的输出。这是输出生成阶段的第一个钩子</td></tr> <tr><td style="text-align:left;">Next Hook</td> <td style="text-align:left;"><code>outputOptions</code> 输出生成阶段的输出，因为这是构建阶段的最后一个挂钩</td></tr></tbody></table> <ul><li>替换或操作传递给<code>bundle.generate()</code>的输出选项对象<code>bundle.write()</code></li> <li>返回<code>null</code>并不能代替任何东西</li> <li>如果您只需要读取输出选项，建议使用<code>renderStart</code>钩子，因为在考虑<code>renderStart</code>所有钩子的转换后，此钩子可以访问输出选项</li></ul> <h4 id="_2-3-4-renderstart"><a href="#_2-3-4-renderstart" class="header-anchor">#</a> 2.3.4 renderStart</h4> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th></tr></thead> <tbody><tr><td style="text-align:left;">Type</td> <td style="text-align:left;">(outputOptions, inputOptions) =&gt; void</td></tr> <tr><td style="text-align:left;">种类</td> <td style="text-align:left;">async, parallel</td></tr> <tr><td style="text-align:left;">上一个钩子</td> <td style="text-align:left;">outputOptions</td></tr> <tr><td style="text-align:left;">下一个钩子</td> <td style="text-align:left;">banner, footer, intro and outro 并行运行</td></tr></tbody></table> <ul><li>每次初始调用<code>bundle.generate()</code>或被<code>bundle.write()</code>调用</li> <li>要在生成完成时收到通知，请使用<code>generateBundle</code>和<code>renderError</code>挂钩</li> <li>当您需要访问传递给的输出选项时，建议使用此挂钩.<code>bundle.generate()</code>或者<code>bundle.write()</code>因为它考虑了所有<code>outputOptions</code>挂钩的转换，并且还包含未设置选项的正确默认值。它还接收传递给的输入选项</li></ul> <h4 id="_2-3-5-banner"><a href="#_2-3-5-banner" class="header-anchor">#</a> 2.3.5 banner</h4> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th> <th></th></tr></thead> <tbody><tr><td style="text-align:left;">Type</td> <td style="text-align:left;">string</td> <td>(() =&gt; string)</td></tr> <tr><td style="text-align:left;">Kind</td> <td style="text-align:left;">async, parallel</td> <td></td></tr> <tr><td style="text-align:left;">Previous Hook</td> <td style="text-align:left;">renderStart</td> <td></td></tr> <tr><td style="text-align:left;">Next Hook</td> <td style="text-align:left;">针对每个动态导入表达式 <code>renderDynamicImport</code></td> <td></td></tr></tbody></table> <h4 id="_2-3-6-footer"><a href="#_2-3-6-footer" class="header-anchor">#</a> 2.3.6 footer</h4> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th> <th></th></tr></thead> <tbody><tr><td style="text-align:left;">Type</td> <td style="text-align:left;">string</td> <td>(() =&gt; string)</td></tr> <tr><td style="text-align:left;">Kind</td> <td style="text-align:left;">async, parallel</td> <td></td></tr> <tr><td style="text-align:left;">Previous Hook</td> <td style="text-align:left;">renderStart</td> <td></td></tr> <tr><td style="text-align:left;">Next Hook</td> <td style="text-align:left;">针对每个动态导入表达式 <code>renderDynamicImport</code></td> <td></td></tr></tbody></table> <h4 id="_2-3-7-intro"><a href="#_2-3-7-intro" class="header-anchor">#</a> 2.3.7 intro</h4> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th> <th></th></tr></thead> <tbody><tr><td style="text-align:left;">Type</td> <td style="text-align:left;">string</td> <td>(() =&gt; string)</td></tr> <tr><td style="text-align:left;">Kind</td> <td style="text-align:left;">async, parallel</td> <td></td></tr> <tr><td style="text-align:left;">Previous Hook</td> <td style="text-align:left;">renderStart</td> <td></td></tr> <tr><td style="text-align:left;">Next Hook</td> <td style="text-align:left;">针对每个动态导入表达式 <code>renderDynamicImport</code></td> <td></td></tr></tbody></table> <h4 id="_2-3-8-outro"><a href="#_2-3-8-outro" class="header-anchor">#</a> 2.3.8 outro</h4> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th> <th></th></tr></thead> <tbody><tr><td style="text-align:left;">Type</td> <td style="text-align:left;">string</td> <td>(() =&gt; string)</td></tr> <tr><td style="text-align:left;">Kind</td> <td style="text-align:left;">async, parallel</td> <td></td></tr> <tr><td style="text-align:left;">Previous Hook</td> <td style="text-align:left;">renderStart</td> <td></td></tr> <tr><td style="text-align:left;">Next Hook</td> <td style="text-align:left;">针对每个动态导入表达式 <code>renderDynamicImport</code></td> <td></td></tr></tbody></table> <h4 id="_2-3-9-renderdynamicimport"><a href="#_2-3-9-renderdynamicimport" class="header-anchor">#</a> 2.3.9 renderDynamicImport</h4> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th></tr></thead> <tbody><tr><td style="text-align:left;">Type</td> <td style="text-align:left;">({format, moduleId, targetModuleId, customResolution}) =&gt; {left: string, right: string}</td></tr> <tr><td style="text-align:left;">Kind</td> <td style="text-align:left;">async, parallel</td></tr> <tr><td style="text-align:left;">Previous Hook</td> <td style="text-align:left;">banner , footer, intro, outro</td></tr> <tr><td style="text-align:left;">Next Hook</td> <td style="text-align:left;"><code>augmentChunkHash</code>对于每个在文件名中包含哈希的块</td></tr></tbody></table> <ul><li>这个钩子提供了对如何呈现动态导入的细粒度控制</li> <li>方法是替换导入表达式参数的左侧 ( import() 和右侧 ( ) 的代码。)</li> <li>返回null延迟到此类型的其他钩子并最终呈现特定于格式的默认值</li> <li>format是渲染的输出格式</li> <li>moduleId执行动态导入的模块的 id</li> <li>如果导入可以解析为内部或外部 id，targetModuleId则将设置为此 id，否则将为null</li></ul> <p>plugins\rollup-plugin-renderDynamicImport.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">dynamicImportPolyfillPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'dynamic-import-polyfill'</span><span class="token punctuation">,</span>
    <span class="token function">renderDynamicImport</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">left</span><span class="token operator">:</span> <span class="token string">'dynamicImportPolyfill('</span><span class="token punctuation">,</span>
        <span class="token literal-property property">right</span><span class="token operator">:</span> <span class="token string">', import.meta.url)'</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">dynamicImportPolyfill</span><span class="token punctuation">(</span><span class="token string">'./msg-ca034dda.js'</span><span class="token punctuation">,</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>default<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">dynamicImportPolyfill</span><span class="token punctuation">(</span><span class="token parameter">filename<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    script<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">&quot;module&quot;</span><span class="token punctuation">;</span>
    script<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>mod<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> absURL <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">.</span>href<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>absURL<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">import * as mod from &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>absURL<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> window.mod = mod;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;text/javascript&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h4 id="_2-3-9-augmentchunkhash"><a href="#_2-3-9-augmentchunkhash" class="header-anchor">#</a> 2.3.9 augmentChunkHash</h4> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th></tr></thead> <tbody><tr><td style="text-align:left;">Type</td> <td style="text-align:left;">(chunkInfo: ChunkInfo) =&gt; string</td></tr> <tr><td style="text-align:left;">Kind</td> <td style="text-align:left;">sync, sequential</td></tr> <tr><td style="text-align:left;">Previous Hook</td> <td style="text-align:left;">renderDynamicImport针对每个动态导入表达式</td></tr> <tr><td style="text-align:left;">Next Hook</td> <td style="text-align:left;"><code>resolveFileUrl</code>对于每次使用<code>import.meta.ROLLUP_FILE_URL_referenceId</code>和<code>resolveImportMeta</code>所有其他访问<code>import.meta</code></td></tr></tbody></table> <ul><li>可用于增加单个块的散列</li> <li>为每个<code>Rollup</code>输出块调用</li> <li>返回一个<code>false</code>值不会修改散列</li> <li>真实值将传递给<code>hash.update</code>.</li> <li>这<code>chunkInfo</code>是<code>generateBundle</code>不依赖文件名的属性的简化版本</li></ul> <h4 id="_2-3-10-resolvefileurl"><a href="#_2-3-10-resolvefileurl" class="header-anchor">#</a> 2.3.10 resolveFileUrl</h4> <ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/import.meta" target="_blank" rel="noopener noreferrer">import.meta<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>是一个给JavaScript模块暴露特定上下文的元数据属性的对象。它包含了这个模块的信息，比如说这个模块的URL。</li></ul> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th></tr></thead> <tbody><tr><td style="text-align:left;">Type</td> <td style="text-align:left;">({chunkId, fileName, format, moduleId, referenceId, relativePath}) =&gt; string</td></tr> <tr><td style="text-align:left;">Kind</td> <td style="text-align:left;">sync, first</td></tr> <tr><td style="text-align:left;">Previous Hook</td> <td style="text-align:left;"><code>augmentChunkHash</code>对于在文件名中包含哈希的每个块</td></tr> <tr><td style="text-align:left;">Next Hook</td> <td style="text-align:left;"><code>renderChunk</code>对于每个块</td></tr></tbody></table> <ul><li>允许自定义Rollup如何解析插件通过此链接发出的文件的URL<code>this.emitFile</code></li> <li>默认情况下，Rollup 将生成代码</li> <li><code>import.meta.ROLLUP_FILE_URL_referenceId</code>该代码应正确生成发出文件的绝对URL，而与输出格式和部署代码的主机系统无关</li></ul> <p>src\index.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> logger <span class="token keyword">from</span> <span class="token string">'logger'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>logger<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>plugins\rollup-plugin-resolveFileUrl.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">resolveFileUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'resolveFileUrl'</span><span class="token punctuation">,</span>
    <span class="token function">resolveId</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>source <span class="token operator">===</span> <span class="token string">'logger'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> source<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter">importee</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>importee <span class="token operator">===</span> <span class="token string">'logger'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> referenceId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emitFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'asset'</span><span class="token punctuation">,</span> <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token string">'console.log(&quot;logger&quot;)'</span><span class="token punctuation">,</span> <span class="token literal-property property">fileName</span><span class="token operator">:</span> <span class="token string">&quot;logger.js&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export default import.meta.ROLLUP_FILE_URL_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>referenceId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">resolveFileUrl</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> chunkId<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> format<span class="token punctuation">,</span> moduleId<span class="token punctuation">,</span> referenceId<span class="token punctuation">,</span> relativePath <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//import.meta.url</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">new URL('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fileName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">', document.baseURI).href</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="_2-3-11-resolveimportmeta"><a href="#_2-3-11-resolveimportmeta" class="header-anchor">#</a> 2.3.11 resolveImportMeta</h4> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th></tr></thead> <tbody><tr><td style="text-align:left;">Type</td> <td style="text-align:left;">(property, {chunkId, moduleId, format}) =&gt; string</td></tr> <tr><td style="text-align:left;">Kind</td> <td style="text-align:left;">sync, first</td></tr> <tr><td style="text-align:left;">Previous Hook</td> <td style="text-align:left;"><code>augmentChunkHash</code>对于在文件名中包含哈希的每个块</td></tr> <tr><td style="text-align:left;">Next Hook</td> <td style="text-align:left;"><code>renderChunk</code>对于每个块</td></tr></tbody></table> <ul><li>允许自定义 Rollup 如何处理<code>import.meta</code>,<code>import.meta.someProperty</code>特别是<code>import.meta.url</code></li> <li>在 ES 模块中，<code>import.meta</code>是一个对象，<code>import.meta.url</code>包含当前模块的 URL</li></ul> <h4 id="_2-3-12-renderchunk"><a href="#_2-3-12-renderchunk" class="header-anchor">#</a> 2.3.12 renderChunk</h4> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th></tr></thead> <tbody><tr><td style="text-align:left;">Type</td> <td style="text-align:left;">(code, chunk, options) =&gt; string</td></tr> <tr><td style="text-align:left;">Kind</td> <td style="text-align:left;">async, sequential</td></tr> <tr><td style="text-align:left;">Previous Hook</td> <td style="text-align:left;"><code>resolveFileUrl</code>对于 . 的每次使用<code>import.meta.ROLLUP_FILE_URL_referenceId</code>和<code>resolveImportMeta</code>所有其他访问<code>import.meta</code></td></tr> <tr><td style="text-align:left;">Next Hook</td> <td style="text-align:left;"><code>generateBundle</code></td></tr></tbody></table> <ul><li>可用于转换单个块</li> <li>为每个<code>rollup</code>输出块文件调用。返回null将不应用任何转换</li></ul> <h4 id="_2-3-13-generatebundle"><a href="#_2-3-13-generatebundle" class="header-anchor">#</a> 2.3.13 generateBundle</h4> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th></tr></thead> <tbody><tr><td style="text-align:left;">Type</td> <td style="text-align:left;">(options, bundle, isWrite) =&gt; void</td></tr> <tr><td style="text-align:left;">Kind</td> <td style="text-align:left;">async, sequential</td></tr> <tr><td style="text-align:left;">Previous Hook</td> <td style="text-align:left;">renderChunk对于每个块</td></tr> <tr><td style="text-align:left;">Next Hook</td> <td style="text-align:left;"><code>writeBundle</code>如果输出是通过生成的，否则这是输出生成阶段的最后一个钩子，如果生成另一个输出<code>bundle.write()</code>，可能会再次跟随<code>outputOptions</code></td></tr></tbody></table> <ul><li>在<code>bundle.generate()</code>之后调用</li> <li>或者在 <code>bundle.write()</code>把文件写入之前调用</li> <li>要在写入文件后修改文件，请使用<code>writeBundle</code>挂钩</li> <li><code>writeBundle</code>提供正在写入或生成的文件的完整列表及其详细信息</li> <li>您可以通过从该钩子中的捆绑对象中删除文件来防止发出文件。要发出其他文件，请使用<code>this.emitFile</code>插件上下文功能</li></ul> <p>plugins\rollup-plugin-html.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> dedent <span class="token keyword">from</span> <span class="token string">'dedent'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'html'</span><span class="token punctuation">,</span>
    <span class="token function">generateBundle</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> bundle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> entryName<span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> fileName <span class="token keyword">in</span> bundle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> assetOrChunkInfo <span class="token operator">=</span> bundle<span class="token punctuation">[</span>fileName<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">//console.log(fileName, assetOrChunkInfo);</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>assetOrChunkInfo<span class="token punctuation">.</span>isEntry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          entryName <span class="token operator">=</span> fileName<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emitFile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'asset'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">fileName</span><span class="token operator">:</span> <span class="token string">'index.html'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">source</span><span class="token operator">:</span> dedent<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
        &lt;!DOCTYPE html&gt;
        &lt;html&gt;
        &lt;head&gt;
          &lt;meta charset=&quot;UTF-8&quot;&gt;
          &lt;title&gt;rollup&lt;/title&gt;
         &lt;/head&gt;
        &lt;body&gt;
          &lt;script src=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>entryName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; type=&quot;module&quot;&gt;&lt;/script&gt;
        &lt;/body&gt;
        &lt;/html&gt;</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h4 id="_2-3-14-writebundle"><a href="#_2-3-14-writebundle" class="header-anchor">#</a> 2.3.14 writeBundle</h4> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th></tr></thead> <tbody><tr><td style="text-align:left;">Type</td> <td style="text-align:left;">(options,bundle) =&gt; void</td></tr> <tr><td style="text-align:left;">Kind</td> <td style="text-align:left;">async, parallel</td></tr> <tr><td style="text-align:left;">Previous Hook</td> <td style="text-align:left;">generateBundle</td></tr> <tr><td style="text-align:left;">Next Hook</td> <td style="text-align:left;">如果被调用，这是输出生成阶段的最后一个钩子，如果生成另一个输出，可能会再次跟随<code>outputOptions</code></td></tr></tbody></table> <ul><li><code>bundle.write()</code>仅在写入所有文件后才调用</li> <li>与<code>generateBundle</code>钩子类似，<code>bundle</code>提供正在写入的文件的完整列表及其详细信息</li></ul> <h4 id="_2-3-15-rendererror"><a href="#_2-3-15-rendererror" class="header-anchor">#</a> 2.3.15 renderError</h4> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th></tr></thead> <tbody><tr><td style="text-align:left;">Type</td> <td style="text-align:left;">(error: Error) =&gt; void</td></tr> <tr><td style="text-align:left;">Kind</td> <td style="text-align:left;">async, parallel</td></tr> <tr><td style="text-align:left;">Previous Hook</td> <td style="text-align:left;">renderStart从到 的任何钩子renderChunk</td></tr> <tr><td style="text-align:left;">Next Hook</td> <td style="text-align:left;"><code>outputOptions</code>如果它被调用，这是输出生成阶段的最后一个钩子，如果生成另一个输出，可能会再次跟随</td></tr></tbody></table> <ul><li><code>bundle.generate()</code>当 rollup 在或期间遇到错误时调用<code>bundle.write()</code></li> <li>错误被传递给这个钩子。要在生成成功完成时收到通知，请使用<code>generateBundle</code>钩子</li></ul> <h4 id="_2-3-16-closebundle"><a href="#_2-3-16-closebundle" class="header-anchor">#</a> 2.3.16 closeBundle</h4> <table><thead><tr><th style="text-align:left;">字段</th> <th style="text-align:left;">值</th> <th></th></tr></thead> <tbody><tr><td style="text-align:left;">Type</td> <td style="text-align:left;">closeBundle: () =&gt; Promise</td> <td>void</td></tr> <tr><td style="text-align:left;">Kind</td> <td style="text-align:left;">async, parallel</td> <td></td></tr> <tr><td style="text-align:left;">Previous Hook</td> <td style="text-align:left;"><code>buildEnd</code> 如果有构建错误.否则何时bundle.close()被调用，在这种情况下，这将是最后一个被触发的钩子。</td> <td></td></tr></tbody></table> <ul><li>可用于清理可能正在运行的任何外部服务</li> <li><code>Rollup</code> 的 <code>CLI</code> 将确保在每次运行后调用此钩子</li> <li>d但 <code>JavaScript API</code> 的用户有责任在<code>bundle.close()</code>他们完成生成包后手动调用</li></ul> <h2 id="_3-plugin-context-插件上下文"><a href="#_3-plugin-context-插件上下文" class="header-anchor">#</a> 3.Plugin Context 插件上下文</h2> <h3 id="_3-1-this-emitfile"><a href="#_3-1-this-emitfile" class="header-anchor">#</a> 3.1 this.emitFile</h3> <blockquote><p><a href="https://rollupjs.org/guide/en/#thisemitfile" target="_blank" rel="noopener noreferrer">this.emitfile<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <ul><li>Type: (emittedFile: EmittedChunk | EmittedAsset) =&gt; string</li> <li>发出一个包含在生成输出中的新文件，并返回一个referenceId，该ID可在不同位置用于引用发出的文件</li> <li>emittedFile 可以有两种形式之一</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>type EmittedChunk <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'chunk'</span><span class="token punctuation">;</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
  name<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
  fileName<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

type EmittedAsset <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'asset'</span><span class="token punctuation">;</span>
  name<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
  fileName<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
  source<span class="token operator">?</span><span class="token operator">:</span> string <span class="token operator">|</span> Uint8Array<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_3-2-this-getmoduleinfo"><a href="#_3-2-this-getmoduleinfo" class="header-anchor">#</a> 3.2 this.getmoduleinfo</h3> <blockquote><p><a href="https://rollupjs.org/guide/en/#thisgetmoduleinfo" target="_blank" rel="noopener noreferrer">this.getmoduleinfo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <ul><li>Type: (moduleId: string) =&gt; (ModuleInfo | null)</li> <li>返回有关相关模块的其他信息</li></ul> <h3 id="_3-3-this-load"><a href="#_3-3-this-load" class="header-anchor">#</a> 3.3 this.load</h3> <blockquote><p><a href="https://rollupjs.org/guide/en/#thisload" target="_blank" rel="noopener noreferrer">this.load<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <ul><li>Type: ({id: string, moduleSideEffects?: boolean | 'no-treeshake' | null, syntheticNamedExports?: boolean | string | null, meta?: {[plugin: string]: any} | null, resolveDependencies?: boolean}) =&gt; Promise</li> <li>加载并解析与给定id对应的模块，并将附加的元信息附加到模块（如果提供）</li> <li>这将触发与另一个模块导入该模块时相同的加载、转换和模块授权挂钩</li></ul> <h3 id="_3-4-this-resolve"><a href="#_3-4-this-resolve" class="header-anchor">#</a> 3.4 this.resolve</h3> <blockquote><p><a href="https://rollupjs.org/guide/en/#thisresolve" target="_blank" rel="noopener noreferrer">this.resolve<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <ul><li>使用Rollup使用的相同插件将导入解析为模块ID（即文件名），并确定导入是否应该是外部的</li> <li>如果返回null，则无法通过Rollup或任何插件解析导入，但用户未明确将其标记为外部</li></ul> <h2 id="_4-实战案例"><a href="#_4-实战案例" class="header-anchor">#</a> 4.实战案例</h2> <h3 id="_4-1-rollup-plugin-babel"><a href="#_4-1-rollup-plugin-babel" class="header-anchor">#</a> 4.1 @rollup/plugin-babel</h3> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>实现Babel插件，将新语法转成兼容性好的es5语法。</p></div> <h4 id="_4-1-1-安装"><a href="#_4-1-1-安装" class="header-anchor">#</a> 4.1.1 安装</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>pnpm install rollup<span class="token operator">-</span>pluginutils @rollup<span class="token operator">/</span>plugin<span class="token operator">-</span>babel @babel<span class="token operator">/</span>core @babel<span class="token operator">/</span>preset<span class="token operator">-</span>env  <span class="token operator">-</span><span class="token constant">D</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_4-1-2-rollup-plugin-babel-js"><a href="#_4-1-2-rollup-plugin-babel-js" class="header-anchor">#</a> 4.1.2 rollup-plugin-babel.js</h4> <p>plugins\rollup-plugin-babel.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createFilter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rollup-pluginutils'</span>
<span class="token keyword">import</span> babel <span class="token keyword">from</span> <span class="token string">'@babel/core'</span>
<span class="token keyword">function</span> <span class="token function">plugin</span><span class="token punctuation">(</span><span class="token parameter">pluginOptions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> defaultExtensions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.jsx'</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> exclude<span class="token punctuation">,</span> include<span class="token punctuation">,</span> extensions <span class="token operator">=</span> defaultExtensions <span class="token punctuation">}</span> <span class="token operator">=</span> pluginOptions<span class="token punctuation">;</span>
  <span class="token keyword">const</span> extensionRegExp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>extensions<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)$</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">)</span>
  <span class="token keyword">const</span> userDefinedFilter <span class="token operator">=</span> <span class="token function">createFilter</span><span class="token punctuation">(</span>include<span class="token punctuation">,</span> exclude<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">filter</span> <span class="token operator">=</span> <span class="token parameter">id</span> <span class="token operator">=&gt;</span> extensionRegExp<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">userDefinedFilter</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'babel'</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token function">transform</span><span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">filter</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> babel<span class="token punctuation">.</span><span class="token function">transformAsync</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> result
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> plugin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="_4-1-3-rollup-config-js"><a href="#_4-1-3-rollup-config-js" class="header-anchor">#</a> 4.1.3 rollup.config.js</h4> <p>rollup.config.js</p> <div class="language-diff line-numbers-mode"><pre class="language-diff"><code><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">//import babel from '@rollup/plugin-babel'
</span><span class="token prefix inserted">+</span><span class="token line">import babel from './plugins/rollup-plugin-babel'
</span></span>export default {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> input: &quot;./src/index.js&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line"> output: [{
</span><span class="token prefix unchanged"> </span><span class="token line">   dir: 'dist',
</span><span class="token prefix unchanged"> </span><span class="token line"> }],
</span><span class="token prefix unchanged"> </span><span class="token line"> plugins: [
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   babel()
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> ]
</span></span>}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="_4-2-rollup-plugin-commonjs"><a href="#_4-2-rollup-plugin-commonjs" class="header-anchor">#</a> 4.2 @rollup/plugin-commonjs</h3> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>将<code>commonjs</code>语法转成<code>es module</code>语法，让rollup可以识别到。</p></div> <h4 id="_3-2-1-安装"><a href="#_3-2-1-安装" class="header-anchor">#</a> 3.2.1 安装</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code>pnpm install  @rollup<span class="token operator">/</span>plugin<span class="token operator">-</span>commonjs   <span class="token operator">--</span><span class="token constant">D</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_4-2-2-src-index-js"><a href="#_4-2-2-src-index-js" class="header-anchor">#</a> 4.2.2 src\index.js</h4> <p>src\index.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> catValue <span class="token keyword">from</span> <span class="token string">'./cat.js'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>catValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_4-2-3-src-cat-js"><a href="#_4-2-3-src-cat-js" class="header-anchor">#</a> 4.2.3 src\cat.js</h4> <p>src\cat.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token string">'catValue'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_4-2-4-rollup-plugin-commonjs-js"><a href="#_4-2-4-rollup-plugin-commonjs-js" class="header-anchor">#</a> 4.2.4 rollup-plugin-commonjs.js</h4> <p>plugins\rollup-plugin-commonjs.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createFilter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rollup-pluginutils'</span>
<span class="token keyword">import</span> MagicString <span class="token keyword">from</span> <span class="token string">'magic-string'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> walk <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'estree-walker'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">pluginOptions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> defaultExtensions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.jsx'</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> exclude<span class="token punctuation">,</span> include<span class="token punctuation">,</span> extensions <span class="token operator">=</span> defaultExtensions <span class="token punctuation">}</span> <span class="token operator">=</span> pluginOptions<span class="token punctuation">;</span>
  <span class="token keyword">const</span> extensionRegExp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>extensions<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)$</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">)</span>
  <span class="token keyword">const</span> userDefinedFilter <span class="token operator">=</span> <span class="token function">createFilter</span><span class="token punctuation">(</span>include<span class="token punctuation">,</span> exclude<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">filter</span> <span class="token operator">=</span> <span class="token parameter">id</span> <span class="token operator">=&gt;</span> extensionRegExp<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">userDefinedFilter</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'commonjs'</span><span class="token punctuation">,</span>
    <span class="token function">transform</span><span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">filter</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">transformAndCheckExports</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>parse<span class="token punctuation">,</span> code<span class="token punctuation">,</span> id<span class="token punctuation">)</span>
      <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">transformAndCheckExports</span><span class="token punctuation">(</span><span class="token parameter">parse<span class="token punctuation">,</span> code<span class="token punctuation">,</span> id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> isEsModule<span class="token punctuation">,</span> ast <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">analyzeTopLevelStatements</span><span class="token punctuation">(</span>parse<span class="token punctuation">,</span> code<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isEsModule<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">transformCommonjs</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> id<span class="token punctuation">,</span> ast<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">getKeypath</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> parts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'MemberExpression'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    parts<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>property<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    node <span class="token operator">=</span> node<span class="token punctuation">.</span>object<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">!==</span> <span class="token string">'Identifier'</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> name <span class="token punctuation">}</span> <span class="token operator">=</span> node<span class="token punctuation">;</span>
  parts<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> <span class="token literal-property property">keypath</span><span class="token operator">:</span> parts<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">analyzeTopLevelStatements</span><span class="token punctuation">(</span><span class="token parameter">parse<span class="token punctuation">,</span> code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> isEsModule <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> node <span class="token keyword">of</span> ast<span class="token punctuation">.</span>body<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">'ExportDefaultDeclaration'</span><span class="token operator">:</span>
        isEsModule <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'ExportNamedDeclaration'</span><span class="token operator">:</span>
        isEsModule <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token string">'ImportDeclaration'</span><span class="token operator">:</span>
        isEsModule <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> isEsModule<span class="token punctuation">,</span> ast <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">transformCommonjs</span><span class="token punctuation">(</span><span class="token parameter">code<span class="token punctuation">,</span> id<span class="token punctuation">,</span> ast</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> magicString <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MagicString</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> exportDeclarations <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> moduleExportsAssignment<span class="token punctuation">;</span>
  <span class="token function">walk</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">enter</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'AssignmentExpression'</span><span class="token operator">:</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'MemberExpression'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> flattened <span class="token operator">=</span> <span class="token function">getKeypath</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>flattened<span class="token punctuation">.</span>keypath <span class="token operator">===</span> <span class="token string">'module.exports'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              moduleExportsAssignment <span class="token operator">=</span> node<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> left <span class="token punctuation">}</span> <span class="token operator">=</span> moduleExportsAssignment<span class="token punctuation">;</span>
  <span class="token keyword">const</span> exportsName <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  magicString<span class="token punctuation">.</span><span class="token function">overwrite</span><span class="token punctuation">(</span>left<span class="token punctuation">.</span>start<span class="token punctuation">,</span> left<span class="token punctuation">.</span>end<span class="token punctuation">,</span> exportsName<span class="token punctuation">)</span><span class="token punctuation">;</span>
  magicString<span class="token punctuation">.</span><span class="token function">prependRight</span><span class="token punctuation">(</span>left<span class="token punctuation">.</span>start<span class="token punctuation">,</span> <span class="token string">'var '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  exportDeclarations<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export default </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>exportsName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> exportBlock <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">\n\n</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>exportDeclarations<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  magicString<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>exportBlock<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">code</span><span class="token operator">:</span> magicString<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br></div></div><h4 id="_4-2-5-rollup-config-js"><a href="#_4-2-5-rollup-config-js" class="header-anchor">#</a> 4.2.5 rollup.config.js</h4> <p>rollup.config.js</p> <div class="language-diff line-numbers-mode"><pre class="language-diff"><code>//import babel from '@rollup/plugin-babel'
//import babel from './plugins/rollup-plugin-babel.js'
//import commonjs from '@rollup/plugin-commonjs'
<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import commonjs from './plugins/rollup-plugin-commonjs'
</span></span>export default {
<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> input: &quot;./src/index.js&quot;,
</span><span class="token prefix unchanged"> </span><span class="token line"> output: {
</span><span class="token prefix unchanged"> </span><span class="token line">   dir: 'dist'
</span><span class="token prefix unchanged"> </span><span class="token line"> },
</span><span class="token prefix unchanged"> </span><span class="token line"> plugins: [
</span><span class="token prefix unchanged"> </span><span class="token line">   //babel(),
</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   commonjs()
</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> ]
</span></span>}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_4-3-rollup-plugin-node-resolve"><a href="#_4-3-rollup-plugin-node-resolve" class="header-anchor">#</a> 4.3 @rollup/plugin-node-resolve</h3> <div class="custom-block tip"><p class="custom-block-title">提示</p> <p>解析<code>node_modules</code>里面的第三方插件</p></div> <h4 id="_4-3-1-安装"><a href="#_4-3-1-安装" class="header-anchor">#</a> 4.3.1 安装</h4> <blockquote><p>相关资料 https://rollupjs.org/guide/en/#warning-treating-module-as-external-dependency</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>pnpm install @rollup<span class="token operator">/</span>plugin<span class="token operator">-</span>node<span class="token operator">-</span>resolve check<span class="token operator">-</span>is<span class="token operator">-</span>array <span class="token operator">-</span><span class="token constant">D</span>
<span class="token function">isarray</span> <span class="token punctuation">(</span>imported by src<span class="token operator">/</span>index<span class="token punctuation">.</span>js<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_4-3-2-src-index-js"><a href="#_4-3-2-src-index-js" class="header-anchor">#</a> 4.3.2 src\index.js</h4> <p>src\index.js</p> <div class="language-diff line-numbers-mode"><pre class="language-diff"><code>import isArray from 'check-is-array';
console.log(isArray);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="_4-3-3-rollup-plugin-node-resolve-js"><a href="#_4-3-3-rollup-plugin-node-resolve-js" class="header-anchor">#</a> 4.3.3 rollup-plugin-node-resolve.js</h4> <p>plugins\rollup-plugin-node-resolve.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Module <span class="token keyword">from</span> <span class="token string">'module'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'resolve'</span><span class="token punctuation">,</span>
    <span class="token comment">//因为我们要改造根据模块的名称查找模所路径的逻辑</span>
    <span class="token keyword">async</span> <span class="token function">resolveId</span><span class="token punctuation">(</span><span class="token parameter">importee<span class="token punctuation">,</span> importer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//如果是相对路径，则走默认逻辑</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>importee<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'.'</span> <span class="token operator">||</span> path<span class="token punctuation">.</span><span class="token function">isAbsolute</span><span class="token punctuation">(</span>importee<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">let</span> location <span class="token operator">=</span> Module<span class="token punctuation">.</span><span class="token function">createRequire</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>importer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>importee<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> location<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> resolve<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="_4-4-rollup-plugin-alias"><a href="#_4-4-rollup-plugin-alias" class="header-anchor">#</a> 4.4 @rollup/plugin-alias</h3> <h4 id="_4-4-1-rollup-config-js"><a href="#_4-4-1-rollup-config-js" class="header-anchor">#</a> 4.4.1 rollup.config.js</h4> <p>rollup.config.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//import build from './plugins/rollup-plugin-build.js';</span>
<span class="token comment">//import polyfill from './plugins/rollup-plugin-inject-polyfill.js';</span>
<span class="token comment">//import babel from './plugins/rollup-plugin-babel.js';</span>
<span class="token comment">//import generation from './plugins/rollup-plugin-generation.js';</span>
<span class="token comment">//import importPolyFill from './plugins/rollup-plugin-import-polyfill.js';</span>
<span class="token comment">//import commonjs from '@rollup/plugin-commonjs';</span>
<span class="token comment">//import commonjs from './plugins/rollup-plugin-commonjs';</span>
<span class="token comment">//import resolve from '@rollup/plugin-node-resolve';</span>
<span class="token keyword">import</span> resolve <span class="token keyword">from</span> <span class="token string">'./plugins/rollup-plugin-node-resolve.js'</span><span class="token punctuation">;</span>
<span class="token comment">//import alias from '@rollup/plugin-alias';</span>
<span class="token keyword">import</span> alias <span class="token keyword">from</span> <span class="token string">'./plugins/rollup-plugin-alias.js'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  <span class="token comment">//watch: true,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">//file: 'dist/main.js',</span>
    <span class="token literal-property property">dir</span><span class="token operator">:</span> <span class="token string">'dist'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">alias</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">entries</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span> <span class="token literal-property property">find</span><span class="token operator">:</span> <span class="token string">'./xx.js'</span><span class="token punctuation">,</span> <span class="token literal-property property">replacement</span><span class="token operator">:</span> <span class="token string">'check-is-array'</span> <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">clearScreen</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h4 id="_4-4-2-rollup-plugin-alias-js"><a href="#_4-4-2-rollup-plugin-alias-js" class="header-anchor">#</a> 4.4.2 rollup-plugin-alias.js</h4> <p>plugins\rollup-plugin-alias.js</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token parameter">pattern<span class="token punctuation">,</span> importee</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pattern <span class="token keyword">instanceof</span> <span class="token class-name">RegExp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> pattern<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>importee<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>importee<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> pattern<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>importee <span class="token operator">===</span> pattern<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> importee<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>pattern <span class="token operator">+</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">alias</span><span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> entries <span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>entries<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'alias'</span><span class="token punctuation">,</span>
            <span class="token function-variable function">resolveId</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'alias'</span><span class="token punctuation">,</span>
        <span class="token function">resolveId</span><span class="token punctuation">(</span><span class="token parameter">importee<span class="token punctuation">,</span> importer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>importer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">const</span> matchedEntry <span class="token operator">=</span> entries<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">matches</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>find<span class="token punctuation">,</span> importee<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>matchedEntry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">const</span> updatedId <span class="token operator">=</span> importee<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>matchedEntry<span class="token punctuation">.</span>find<span class="token punctuation">,</span> matchedEntry<span class="token punctuation">.</span>replacement<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//调用this.resolve意味着重新解析</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>updatedId<span class="token punctuation">,</span> importer<span class="token punctuation">,</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">skipSelf</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolved</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> resolved <span class="token operator">||</span> <span class="token punctuation">{</span> <span class="token literal-property property">id</span><span class="token operator">:</span> updatedId <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> alias<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>总结：80%的插件就用到了<code>resovleId</code> (解析模块路径钩子)，<code>transform</code> (转换模块内容钩子)，还有就是<code>load</code>(加载模块id对应的内容)这三个钩子，只要掌握了这三个钩子就可以实现绝大部分的功能。</p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com//sunnyxujian/edit/master/docs/03.工程化/05.rollup/06.rollup插件.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=rollup-plugin" title="标签">#rollup-plugin</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/05/23, 15:08:15</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/d5d86e/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">手写rollup原理</div></a> <a href="/engineering/vite/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">vite基本用法和项目实践</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/d5d86e/" class="prev">手写rollup原理</a></span> <span class="next"><a href="/engineering/vite/">vite基本用法和项目实践</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/de22dd/"><div>😍Vue3和React都在用的函数式编程，学起来~</div></a> <span>02-03</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/29bc3b/"><div>链表</div></a> <span>11-24</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/7f20fa/"><div>基础类型</div></a> <span>11-18</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:1227971544@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/sunnyxujian" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a>Vdoing</a> 
    | Copyright © 2020-2023
    <span>xujian | <a href="https://gitee.com/microjan/blog/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">跟随系统</li><li class="iconfont icon-rijianmoshi">浅色模式</li><li class="iconfont icon-yejianmoshi">深色模式</li><li class="iconfont icon-yuedu">阅读模式</li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"><div></div><div class="cat-container" data-v-a13867c0><canvas id="vuepress-cat" width="280" height="250" class="live2d" data-v-a13867c0></canvas></div><!----><div class="RibbonAnimation"></div></div></div>
    <script src="/assets/js/app.d76a6140.js" defer></script><script src="/assets/js/3.724bf448.js" defer></script><script src="/assets/js/5.f79ce4cb.js" defer></script><script src="/assets/js/84.17e1691d.js" defer></script>
  </body>
</html>